trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  nodeVersion: '22.x'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '$(nodeVersion)'
    displayName: 'Install Node.js $(nodeVersion)'

  - task: Cache@2
    inputs:
      key: 'npm | "$(Agent.OS)" | package-lock.json'
      path: '$(Pipeline.Workspace)/.npm'
    displayName: 'Cache npm packages'

  - task: Cache@2
    inputs:
      key: 'nextjs | "$(Agent.OS)" | package-lock.json'
      path: '.next/cache'
    displayName: 'Cache Next.js build'

  - script: npm ci
    displayName: 'Install dependencies'

  - script: npm run build
    displayName: 'Build static site'

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: 'out'
      artifactName: 'static-site'
    displayName: 'Publish static site artifact'

  # Uncomment and configure to deploy to Azure Web App:
  # - task: AzureWebApp@1
  #   inputs:
  #     azureSubscription: '$(azureSubscription)'
  #     appName: '$(webAppName)'
  #     package: 'out'
  #   displayName: 'Deploy to Azure Web App'
